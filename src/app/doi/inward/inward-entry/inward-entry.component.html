<div class="container">
  <div class="form-wrapper">
    <div class="heading-section ng-star-inserted">
      <div> Inward Entry</div>
      <div class="font-heading"><strong>Reference Number:</strong>{{referenceNumber}}</div>
      <div class="font-heading"><strong>Reference Date:</strong> {{ todayDate | date: 'dd-MMM-yyyy HH:mm'}}
      </div>
    </div>

    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="#">Home</a></li>
        <li class="breadcrumb-item " aria-current="page">DOI / INWARD</li>
        <li class="breadcrumb-item active" aria-current="page"> Inward Entry </li>
      </ol>
    </nav>

    <div class="panel-group">
      <form [formGroup]="inwardEntryForm" #formDirective="ngForm">
        <mat-tab-group mat-stretch-tabs class="standing-est-tabing" [selectedIndex]="selectedIndex">
          <mat-tab label="Inward Entry">
          <!-- Inward Entry  -->
        <div class="box box-primary">
          <div class="box-header"> Inward Entry </div>
          <div class="box-body">
            <div class="row">

              <!-- inward number -->
              <div class="col-md-3">
                <mat-form-field>
                  <input matInput formControlName="inwardNo" placeholder="Inward Number">
                </mat-form-field>
              </div>


                 <!-- inward date -->
                 <div class="col-md-3">
                  <mat-form-field>
                    <input matInput formControlName="inwardDate" placeholder="Inward Date">
                  </mat-form-field>
                </div>

              <!-- Inward type -->
              <div class="col-sm-3">
                <mat-form-field class="full-width">
                  <mat-select formControlName="inwardType" [disabled]="isUpdate" placeholder="Inward Type" required>
                    <mat-option>
                      <ngx-mat-select-search [formControl] ="inwardTypeCtrl" [placeholderLabel]="'Find Inward Type ...'"
                        [noEntriesFoundLabel]="'no matching Inward Type found'">
                      </ngx-mat-select-search>
                    </mat-option>
                    <mat-option *ngFor = "let item of inward_type | filterSelectInput: inwardTypeCtrl.value" [value]="item.viewValue">{{item.viewValue}}
                    </mat-option>
                  </mat-select>
                  <div class="error-wrapper"
                    *ngIf="inwardEntryForm.get('inwardType').touched && inwardEntryForm.get('inwardType').errors">
                    <mat-error *ngIf="inwardEntryForm.get('letter.inwardType').errors.required">
                      {{errorMessage.LETTER_TYPE}}
                    </mat-error>
                  </div>
                </mat-form-field>
              </div>

              <!-- branch name -->
              <div class="col-sm-3" *ngIf="inwardEntryForm.value.inwardType == 'Letter'">
                <mat-form-field class="full-width" formGroupName="letter">
                  <mat-select formControlName="branchName" placeholder="Branch Name" (valueChange)="populateLetterType($event)" required>
                    <mat-option>
                      <ngx-mat-select-search [formControl]="branchNameCtrl" [placeholderLabel]="'Find Branch Name ...'"
                        [noEntriesFoundLabel]="'no matching Branch Name found'">
                      </ngx-mat-select-search>
                    </mat-option>
                    <mat-option *ngFor="let item of branchName_list | filterSelectInput: branchNameCtrl.value"
                      [value]="item.viewValue">
                      {{item.viewValue}}
                    </mat-option>
                  </mat-select>
                  <div class="error-wrapper"
                    *ngIf="inwardEntryForm.get('letter.branchName').touched && inwardEntryForm.get('letter.branchName').errors">
                    <mat-error *ngIf="inwardEntryForm.get('letter.branchName').errors.required">
                      {{errorMessage.BRANCH_NAME}}
                    </mat-error>
                  </div>
                </mat-form-field>
              </div>


              <!-- letter type -->
              <div class="col-sm-3" *ngIf="inwardEntryForm.value.inwardType == 'Letter'">
                <mat-form-field class="full-width" formGroupName="letter">
                  <mat-select formControlName="letterType" placeholder="Letter Type" required>
                    <mat-option>
                      <ngx-mat-select-search [formControl]="letterTypeCtrl" [placeholderLabel]="'Find Letter Type ...'"
                        [noEntriesFoundLabel]="'no matching Letter Type found'">
                      </ngx-mat-select-search>
                    </mat-option>
                    <mat-option *ngFor="let item of letterTypeToDisplay | filterSelectInput: letterTypeCtrl.value" [value]="item.viewValue">
                      {{item.viewValue}}
                    </mat-option>
                  </mat-select>
                  <div class="error-wrapper"
                    *ngIf="inwardEntryForm.get('letter.letterType').touched && inwardEntryForm.get('letter.letterType').errors">
                    <mat-error *ngIf="inwardEntryForm.get('letter.letterType').errors.required">
                      {{errorMessage.LETTER_TYPE}}
                    </mat-error>
                  </div>
                </mat-form-field>
              </div>


              <!-- letter no -->
              <div class="col-md-3"  *ngIf="inwardEntryForm.value.inwardType == 'Letter'">
                <mat-form-field formGroupName="letter">
                  <input matInput formControlName="letterNo" placeholder="Letter Number" [required]="isReadOnlyForUpdate" [readonly] = "isUpdate">
                  <div class="error-wrapper"
                    *ngIf="inwardEntryForm.get('letter.letterNo').touched && inwardEntryForm.get('letter.letterNo').errors">
                    <mat-error *ngIf="inwardEntryForm.get('letter.letterNo').errors.required">
                      {{errorMessage.LETTER_NO}}
                    </mat-error>
                  </div>
                </mat-form-field>
              </div>

              <!-- letter date -->
              <div class="col-sm-3"  *ngIf="inwardEntryForm.value.inwardType == 'Letter'" >
                <mat-form-field formGroupName="letter" >
                  <input matInput [matDatepicker]="letterDate" formControlName="letterDate" placeholder="Letter Date" [readonly] = "isUpdate"
                  [required]="isReadOnlyForUpdate">
                  <mat-datepicker-toggle matSuffix [for]="letterDate"></mat-datepicker-toggle>
                  <mat-datepicker #letterDate></mat-datepicker>
                  <div class="error-wrapper"
                    *ngIf="inwardEntryForm.get('letter.letterDate').touched && inwardEntryForm.get('letter.letterDate').errors">
                    <mat-error *ngIf="inwardEntryForm.get('letter.letterDate').errors.required">
                      {{ errorMessage.LETTERDATE}}
                    </mat-error>
                  </div>
                </mat-form-field>
              </div>

              <!-- letter detail -->
              <div class="col-md-3"  *ngIf="inwardEntryForm.value.inwardType == 'Letter'">
                <mat-form-field formGroupName="letter">
                  <input matInput formControlName="letterDetail" placeholder="Letter Details" [required]="isReadOnlyForUpdate" [readonly]="isUpdate">
                  <div class="error-wrapper"
                    *ngIf="inwardEntryForm.get('letter.letterDetail').touched && inwardEntryForm.get('letter.letterDetail').errors">
                    <mat-error *ngIf="inwardEntryForm.get('letter.letterDetail').errors.required">
                      {{errorMessage.LETTER_DETAIL}}
                    </mat-error>
                  </div>
                </mat-form-field>
              </div>

                <!-- Cheque no -->
                <div class="col-md-3" *ngIf="inwardEntryForm.value.inwardType == 'Cheque'">
                  <mat-form-field formGroupName="cheque">
                    <input matInput formControlName="chequeNo" placeholder="Cheque No." [required]="isReadOnlyForUpdate" [readonly]="isUpdate" >
                    <div class="error-wrapper"
                      *ngIf="inwardEntryForm.get('cheque.chequeNo').touched && inwardEntryForm.get('cheque.chequeNo').errors">
                      <mat-error *ngIf="inwardEntryForm.get('cheque.chequeNo').errors.required">
                        {{errorMessage.CHEQUENO}}
                      </mat-error>
                    </div>
                  </mat-form-field>
                </div>


                <!-- Cheque type -->
                <div class="col-md-3" *ngIf="inwardEntryForm.value.inwardType == 'Cheque'">
                  <mat-form-field formGroupName="cheque">
                    <input matInput formControlName="chequeType" placeholder="Cheque Type" [required]="isReadOnlyForUpdate" [readonly]="isUpdate">
                    <div class="error-wrapper"
                      *ngIf="inwardEntryForm.get('cheque.chequeType').touched && inwardEntryForm.get('cheque.chequeType').errors">
                      <mat-error *ngIf="inwardEntryForm.get('cheque.chequeType').errors.required">
                        {{errorMessage.CHEQUETYPE}}
                      </mat-error>
                    </div>
                  </mat-form-field>
                </div>

                <!-- Amount -->
                <div class="col-md-3" *ngIf="inwardEntryForm.value.inwardType == 'Cheque'">
                  <mat-form-field formGroupName="cheque">
                    <input matInput formControlName="amount" placeholder="Amount" [required]="isReadOnlyForUpdate" [readonly]="isUpdate">
                    <div class="error-wrapper"
                      *ngIf="inwardEntryForm.get('cheque.amount').touched && inwardEntryForm.get('cheque.amount').errors">
                      <mat-error *ngIf="inwardEntryForm.get('cheque.amount').errors.required">
                        {{errorMessage.AMMOUNT}}
                      </mat-error>
                    </div>
                  </mat-form-field>
                </div>

                    <!-- Cheque date -->
                    <div class="col-sm-3"  *ngIf="inwardEntryForm.value.inwardType == 'Cheque'">
                      <mat-form-field formGroupName="cheque">
                        <input matInput [matDatepicker]="chequeDate" formControlName="chequeDate" placeholder="Cheque Date"
                        [required]="isReadOnlyForUpdate" [readonly]="isUpdate">
                        <mat-datepicker-toggle matSuffix [for]="chequeDate"></mat-datepicker-toggle>
                        <mat-datepicker #chequeDate></mat-datepicker>
                        <div class="error-wrapper"
                          *ngIf="inwardEntryForm.get('cheque.chequeDate').touched && inwardEntryForm.get('cheque.chequeDate').errors">
                          <mat-error *ngIf="inwardEntryForm.get('cheque.chequeDate').errors.required">
                            {{ errorMessage.CHEQUEDATE}}
                          </mat-error>
                        </div>
                      </mat-form-field>
                    </div>

                    <!-- bank name -->
                  <div class="col-sm-3" *ngIf="inwardEntryForm.value.inwardType == 'Cheque'">
                    <mat-form-field class="full-width" formGroupName="cheque">
                      <mat-select formControlName="bankName" placeholder="Bank Name" (valueChange)="populateBankBranches($event)" [disabled]="isUpdate" required>
                        <mat-option>
                          <ngx-mat-select-search [formControl]="bankNameCtrl" [placeholderLabel]="'Find Bank Name ...'"
                            [noEntriesFoundLabel]="'no matching bank found'">
                          </ngx-mat-select-search>
                        </mat-option>
                        <mat-option *ngFor="let bank of bank_name | filterSelectInput: bankNameCtrl.value" [value]="bank">
                          {{ bank }}
                        </mat-option>
                      </mat-select>
                      <div class="error-wrapper" *ngIf="inwardEntryForm.get('cheque.bankName').touched && inwardEntryForm.get('cheque.bankName').errors">
                        <mat-error
                          *ngIf="inwardEntryForm.get('cheque.bankName').errors.required">
                          {{ errorMessage.BANKNAME}}
                        </mat-error>
                      </div>
                    </mat-form-field>
                  </div>

                    <!-- bank branch name -->
                  <div class="col-sm-3" *ngIf="inwardEntryForm.value.inwardType == 'Cheque'">
                    <mat-form-field class="full-width" formGroupName="cheque">
                      <mat-select formControlName="bankBranchName" placeholder="Branch Name" [disabled]="isUpdate" required>
                        <mat-option>
                          <ngx-mat-select-search [formControl]="bankBranchNameCtrl" [placeholderLabel]="'Find Bank Name ...'"
                            [noEntriesFoundLabel]="'no matching branch name found'">
                          </ngx-mat-select-search>
                        </mat-option>
                        <mat-option *ngFor="let branch of bankBranchNamesToDisplay | filterSelectInput: bankBranchNameCtrl.value" [value]="branch">
                          {{ branch }}
                        </mat-option>
                      </mat-select>
                      <div class="error-wrapper" *ngIf="inwardEntryForm.get('cheque.bankBranchName').touched && inwardEntryForm.get('cheque.bankBranchName').errors">
                        <mat-error
                          *ngIf="inwardEntryForm.get('cheque.bankBranchName').errors.required">
                          {{ errorMessage.BRANCH_NAME}}
                        </mat-error>
                      </div>
                    </mat-form-field>
                  </div>


              <!-- from which place/person -->
              <div class="col-sm-3">
                <mat-form-field>
                  <textarea matInput rows="1" maxlength="60" placeholder="From which place/person"
                    formControlName="fromWhichPlacePerson" [required]="isReadOnlyForUpdate" [readonly]="isUpdate && inwardEntryForm.get('inwardType').value != 'Cheque'"></textarea>
                  <div class="error-wrapper"
                    *ngIf="inwardEntryForm.get('fromWhichPlacePerson').touched && inwardEntryForm.get('fromWhichPlacePerson').errors">
                    <mat-error *ngIf="inwardEntryForm.get('fromWhichPlacePerson').errors.required">
                      {{ errorMessage.FROM_WHICH_PLACE_PERSON }}
                    </mat-error>
                  </div>
                </mat-form-field>
              </div>


              <!-- employee name -->
              <div class="col-md-3">
                <mat-form-field>
                  <input matInput formControlName="employeeName" placeholder="Employee Name">
                  <div class="error-wrapper"
                    *ngIf="inwardEntryForm.controls.employeeName.touched && inwardEntryForm.controls.employeeName.errors">
                    <mat-error *ngIf="inwardEntryForm.controls.employeeName.errors.required">
                      {{errorMessage.EMPLOYEE_NAME}}
                    </mat-error>
                  </div>
                </mat-form-field>
              </div>

              <!-- form buttons -->
              <div class="col-sm-12">
                <div class="form-action-button">
                  <button type="button" mat-raised-button color="primary" title="Save and Proceed" (click)="addRecord()">
                    <i class="material-icons" aria-hidden="true">add</i> Save and Proceed
                  </button>
                  <button type="submit" mat-raised-button color="warn" title="Listing" (click)="onListing()">
                    <i class="material-icons" aria-hidden="true">menu</i> Listing
                  </button>
                  <button type="button" mat-raised-button color="accent" (click)="clearForm()">
                    <i class="material-icons" aria-hidden="true">
                      restore
                    </i>
                    Reset
                  </button>
                </div>
                <!-- End form buttons -->
              </div>
            </div>

    <!-- listing start -->
    <div class="mat-elevation-z8 mt-2">
      <table mat-table [dataSource]="dataSource" matSort aria-describedby="masterClaimTable">

        <!-- serial No -->
        <ng-container matColumnDef="position">
          <th mat-header-cell *matHeaderCellDef scope="row">Sr. No.</th>
          <td mat-cell *matCellDef="let element;let i= index" class="centerAlign">
            {{i+1}}
          </td>
        </ng-container>

        <!-- inward No -->
        <ng-container matColumnDef="inwardNo">
          <th mat-header-cell *matHeaderCellDef scope="row">Inward Number</th>
          <td mat-cell *matCellDef="let element">
            {{ element.inward_no }}
          </td>
        </ng-container>

        <!-- inward date -->
        <ng-container matColumnDef="inwardDate">
          <th mat-header-cell *matHeaderCellDef scope="row">Inward Date</th>
          <td mat-cell *matCellDef="let element">
            {{ element.inward_dt | date:'dd-MMM-yyyy'}}
          </td>
        </ng-container>

        <!-- inward type -->
        <ng-container matColumnDef="inwardType">
          <th mat-header-cell *matHeaderCellDef scope="row">Inward Type</th>
          <td mat-cell *matCellDef="let element">
            {{ element.inward_type }}
          </td>
        </ng-container>

            <!-- letter type/ cheque type -->
            <ng-container matColumnDef="letterType">
              <th mat-header-cell *matHeaderCellDef scope="row">Letter/Cheque Type </th>
              <div *ngIf="inwardEntryForm.value.inwardType == 'Letter'">
               <td mat-cell *matCellDef="let element">
                {{ element.letter_type }}
              </td>
              </div>
              <div *ngIf="inwardEntryForm.value.inwardType == 'Cheque'">
              <td mat-cell *matCellDef="let element">
                {{ element.cheque_type }}
              </td>
              </div>
            </ng-container>

       <!-- letter no/ cheque no  -->
       <ng-container matColumnDef="letterNo">
        <th mat-header-cell *matHeaderCellDef scope="row">Letter/Cheque No.</th>
      <div *ngIf="inwardEntryForm.value.inwardType == 'Letter'">
        <td mat-cell *matCellDef="let element">
          {{ element.letter_no }}
        </td>
      </div>
      <div *ngIf="inwardEntryForm.value.inwardType == 'Cheque'">
        <td mat-cell *matCellDef="let element">
          {{ element.cheque_no }}
        </td>
      </div>
      </ng-container>

      <!-- letter date/ cheque date -->
      <ng-container matColumnDef="letterDate">
        <th mat-header-cell *matHeaderCellDef scope="row">Letter/Cheque Date </th>
        <div *ngIf="inwardEntryForm.value.inwardType == 'Letter'">
        <td mat-cell *matCellDef="let element" class="rightAlign">
          {{ element.letter_dt | date:'dd-MMM-yyyy'}}
        </td>
        </div>
        <div *ngIf="inwardEntryForm.value.inwardType == 'Cheque'">
        <td mat-cell *matCellDef="let element" class="rightAlign">
          {{ element.cheque_dt | date:'dd-MMM-yyyy'}}
        </td>
        </div>
      </ng-container>

        <!-- from which place / person -->
        <ng-container matColumnDef="fromWhichPlacePerson">
          <th mat-header-cell *matHeaderCellDef scope="row">From Which Person/Place</th>
          <td mat-cell *matCellDef="let element">
            {{ element.from_where_details }}
          </td>
        </ng-container>

        <!-- branch name -->
        <ng-container matColumnDef="branchName">
          <th mat-header-cell *matHeaderCellDef scope="row">Branch Name</th>
          <div *ngIf="inwardEntryForm.value.inwardType == 'Letter'">
          <td mat-cell *matCellDef="let element">
            {{ element.branch_name}}
          </td>
          </div>
          <div *ngIf="inwardEntryForm.value.inwardType == 'Cheque'">
          <td mat-cell *matCellDef="let element">
            N/A
          </td>
          </div>

        </ng-container>

        <!-- employee name -->
        <ng-container matColumnDef="employeeName">
          <th mat-header-cell *matHeaderCellDef scope="row">Employee Name</th>
          <td mat-cell *matCellDef="let element">
            {{ element.doi_employee_name}}
          </td>
        </ng-container>


        <!-- action -->
        <ng-container matColumnDef="action">
          <th mat-header-cell *matHeaderCellDef scope="row"> Action </th>
          <td mat-cell *matCellDef="let element" class="text-center">

            <a><i class="material-icons plus view-icon mr-2" title="View">remove_red_eye</i></a>
            <a><i class="material-icons plus edit-icon mr-2" aria-hidden="true" title="Edit" (click)="onEditForm(element)">
                edit </i></a>
            <a class="delete-icon"><i class="material-icons plus delete mr-2" title="delete" aria-hidden="true" (click)="onRemove(element)">
                delete</i></a>
          </td>
        </ng-container>

        <!-- display header row -->
        <tr mat-header-row *matHeaderRowDef="columns"></tr>

        <!-- display data rows in table -->
        <tr mat-row *matRowDef="let row; let i = index;columns:columns">
        </tr>

      </table>

      <!-- paginator -->
      <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>

      <!-- action button -->
      <div class="form-action-button">

        <button type="button" mat-raised-button class="green" title="Submit" (click)="onSubmit()" [disabled] = "ElementData.length == 0">
          <i class="material-icons" title="Close" aria-hidden="true">
            done
          </i>
          Submit
        </button>

      </div>
      <!-- End Action Button -->
    </div>
  </div>
</div>
</mat-tab>

<mat-tab label="Attachments" [disabled]="selectedIndex == 0">

  <app-common-attachment [attachemntValue]="attachmentTypeCode"></app-common-attachment>
  <div class="form-action-button">
    <button type="submit" mat-raised-button color="primary">
      <i class="material-icons" aria-hidden="true" title="Save">
        save
      </i>
      Upload
    </button>

    <button type="button" mat-raised-button budget-list color="warn" (click)="onListing()">
      <i class="material-icons" aria-hidden="true" title="Listing">
        list
      </i>
      Listing
    </button>

    <button type="button" mat-raised-button budget-list color="primary">
      <i class="material-icons" aria-hidden="true" title="Add">
      add
      </i>
      Add
    </button>

    <button type="button" mat-raised-button class="btnClose">
      <i class="material-icons" aria-hidden="true" title="Budget dashboard">
        close
      </i>
      Close
    </button>
  </div>
</mat-tab>
</mat-tab-group>
</form>
</div>
<!-- Inward Entry Ends -->
</div>
</div>

