<div class="container">
  <div class="form-wrapper">

    <div class="heading-section ng-star-inserted">
      <div>Stamp Receipt</div>
      <div class="font-heading">
        <b>Reference No:</b> 19-20/STM/SR/001</div>
      <div class="font-heading">
        <b>Reference Date:</b> {{ date | date: 'dd-MMM-yyyy HH:mm'}}</div>
    </div>

    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="#">Home</a></li>
        <li class="breadcrumb-item"><a href="#">Stamp Processing</a></li>
        <li class="breadcrumb-item active" aria-current="page">Stamp Receipt</li>
      </ol>
    </nav>

    <div class="panel-group">
      <!-- Stamp Receipt Entry Section Starts-->
      <div class="box box-primary">
        <div class="box-header">Stamp Receipt</div>
        <div class="box-body">

          <div #parentGrids>
            <form [formGroup]="stampReceipt">
              <div class="row">
                <div class="col-sm-3">
                  <mat-form-field class="full-width disabled">
                    <input matInput type="text" formControlName="finYear" placeholder="Financial Year" required
                      readonly>

                  <div class="error-wrapper"
                    *ngIf="stampReceipt.controls.finYear.touched && (stampReceipt.controls.finYear.errors)">
                    <mat-error *ngIf="stampReceipt.controls.finYear.errors.required">
                      {{errorMessages.FIN_YEAR}}
                    </mat-error>
                  </div>
                  </mat-form-field>
                </div>

                <div class="col-sm-3">
                  <mat-form-field class="full-width disabled">
                    <input matInput type="text" formControlName="treOff" [value]="treOffVal" #treVal
                    [matTooltip]="treVal.value" placeholder="Treasury Office" readonly>
                  </mat-form-field>
                </div>

                <div class="col-sm-3">
                  <mat-form-field class="disabled">
                    <input matInput formControlName="recDate" placeholder="Date of Receipt"
                      [value]="date | date: 'dd-MMM-yyyy'" readonly>
                    <mat-datepicker-toggle matSuffix [for]="picker1" disabled></mat-datepicker-toggle>
                    <mat-datepicker #picker1></mat-datepicker>
                  </mat-form-field>
                </div>

                <div class="col-sm-3">
                  <mat-form-field class="full-width">
                    <mat-select formControlName="modeReceipt" #modeStamp placeholder="Mode of Stamp Receipt"
                      (selectionChange)="updateColumns()" required>
                      <mat-option>
                        <ngx-mat-select-search [formControl]="modeReceiptCtrl"
                          [placeholderLabel]="'Find Mode of Stamp Receipt...'"
                          [noEntriesFoundLabel]="'no Mode of Stamp Receipt found'">
                        </ngx-mat-select-search>
                      </mat-option>
                      <mat-option *ngFor="let req of modeReceipt_List | filterSelectInput:modeReceiptCtrl.value"
                        [value]="req.value">
                        {{req.viewValue}}
                      </mat-option>
                    </mat-select>

                  <div class="error-wrapper"
                    *ngIf="stampReceipt.controls.modeReceipt.touched && (stampReceipt.controls.modeReceipt.errors)">
                    <mat-error *ngIf="stampReceipt.controls.modeReceipt.errors.required">
                      {{errorMessages.MODE}}
                    </mat-error>
                  </div>
                  </mat-form-field>
                </div>

                <div class="col-sm-3" *ngIf="stampReceipt.controls.modeReceipt.value=='1'">
                  <mat-form-field class="full-width">
                    <mat-select formControlName="indentNumber" placeholder="Indent Number" required>
                      <mat-option>
                        <ngx-mat-select-search [formControl]="indentNumberCtrl"
                          [placeholderLabel]="'Find Indent Number...'" [noEntriesFoundLabel]="'no Indent Number found'">
                        </ngx-mat-select-search>
                      </mat-option>
                      <mat-option *ngFor="let stm of indentNumber_List | filterSelectInput:indentNumberCtrl.value"
                        [value]="stm.value">
                        {{stm.viewValue}}
                      </mat-option>
                    </mat-select>

                  <div class="error-wrapper"
                    *ngIf="stampReceipt.controls.indentNumber.touched && (stampReceipt.controls.indentNumber.errors)">
                    <mat-error *ngIf="stampReceipt.controls.indentNumber.errors.required">
                      {{errorMessages.INDENT_NUM}}
                    </mat-error>
                  </div>
                  </mat-form-field>
                </div>

                <div class="col-sm-3"
                  *ngIf="(stampReceipt.controls.indentNumber.value=='1' || stampReceipt.controls.indentNumber.value=='2' || stampReceipt.controls.indentNumber.value=='3') && (stampReceipt.controls.modeReceipt.value!='2')">
                  <mat-form-field class="full-width disabled">
                    <input matInput type="text" formControlName="indentTo" #indentToVal [matTooltip]="indentToVal.value"
                    placeholder="Indent To" readonly>
                  </mat-form-field>
                </div>

                <div class="col-sm-3" *ngIf="stampReceipt.controls.modeReceipt.value=='2'">
                  <mat-form-field class="full-width">
                    <mat-select formControlName="subTreOff" placeholder="Sub Treasury Office" required>
                      <mat-option>
                        <ngx-mat-select-search [formControl]="subTreOffCtrl"
                          [placeholderLabel]="'Find Sub Treasury Office...'"
                          [noEntriesFoundLabel]="'no Sub Treasury Office found'">
                        </ngx-mat-select-search>
                      </mat-option>
                      <mat-option *ngFor="let req of subTreOff_List | filterSelectInput:subTreOffCtrl.value"
                      [matTooltip]="req.viewValue" [value]="req.value">
                        {{req.viewValue}}
                      </mat-option>
                    </mat-select>

                  <div class="error-wrapper"
                    *ngIf="stampReceipt.controls.subTreOff.touched && (stampReceipt.controls.subTreOff.errors)">
                    <mat-error *ngIf="stampReceipt.controls.subTreOff.errors.required">
                      {{errorMessages.SUB_TRE}}
                    </mat-error>
                  </div>
                  </mat-form-field>
                </div>

              </div>
            </form>
            <!-- Action Buttons -->
            <div class="form-action-button">
              <button type="submit" mat-raised-button color="primary" (click)="whenAddClick()" title="Add">
                <i class="material-icons" aria-hidden="true">
                  add
                </i>
                Add
              </button>
            </div>

          </div>
        </div>
      </div>
      <!-- Stamp Receipt Entry Section Ends-->


      <!-- Table Section -->
          <div class="mat-elevation-z8 tableSelectFix table-responsive mt-2"
          *ngIf="(onAdd) && (stampReceipt.controls.modeReceipt.value=='1' || stampReceipt.controls.modeReceipt.value=='2')">
              <table mat-table [dataSource]="dataSource" multiTemplateDataRows aria-describedby="stampReceiptToTable"
                class="mat-elevation-z8">

                <!-- Sr. No.  -->
                <ng-container matColumnDef="position">
                  <th mat-header-cell *matHeaderCellDef scope="row">Sr. No. </th>
                  <td mat-cell *matCellDef="let element;let i=index" class="centerAlign"> {{element.position}} </td>
                </ng-container>

                <!-- Type Of Stamp -->
                <ng-container matColumnDef="typeOfStamp">
                  <th mat-header-cell *matHeaderCellDef scope="row">Type Of Stamp</th>
                  <td mat-cell *matCellDef="let element" class="leftAlign">
                      {{element.typeOfStamp}}
                  </td>
                </ng-container>

                <!-- Denomination Value -->
                <ng-container matColumnDef="deno">
                  <th mat-header-cell *matHeaderCellDef scope="row">Denomination Value</th>
                  <td mat-cell *matCellDef="let element" class="leftAlign">
                    <div *ngIf="element.isNew">
                      <mat-form-field>
                        <mat-select [(value)]="element.denominationvalue" name="denominationvalue">
                          <mat-option *ngFor="let item of denoVal_list" [value]="item.value">
                            {{item.viewValue}}
                          </mat-option>
                        </mat-select>
                      </mat-form-field>
                    </div>
                    <div *ngIf="!element.isNew">
                      {{element.deno}}
                    </div>
                  </td>
                </ng-container>

                <!-- Stock provided against previous indent -->
                <ng-container matColumnDef="prevIndent">
                  <th mat-header-cell *matHeaderCellDef scope="row">Stock provided against previous indent</th>
                  <td mat-cell *matCellDef="let element" class="leftAlign">
                    <div *ngIf="element.isNew">
                      <mat-form-field floatLabel="never">
                        <input matInput [value]="element.prevIndent" [(ngModel)]="element.prevIndent"
                          [ngModelOptions]="{standalone: true}">
                      </mat-form-field>
                    </div>
                    <div *ngIf="!element.isNew">
                      {{element.prevIndent}}
                    </div>
                  </td>
                </ng-container>

                <!-- Quantity due against previous indent -->
                <ng-container matColumnDef="qtyprevIndent">
                  <th mat-header-cell *matHeaderCellDef scope="row">Quantity due against previous indent</th>
                  <td mat-cell *matCellDef="let element" class="leftAlign">
                    <div *ngIf="element.isNew">
                      <mat-form-field floatLabel="never">
                        <input matInput [value]="element.qtyprevIndent" [(ngModel)]="element.qtyprevIndent"
                          [ngModelOptions]="{standalone: true}">
                      </mat-form-field>
                    </div>
                    <div *ngIf="!element.isNew">
                      {{element.qtyprevIndent}}
                    </div>
                  </td>
                </ng-container>

                <!-- Requested Quantity by Treasury Office -->
                <ng-container matColumnDef="reuseQty">
                  <th mat-header-cell *matHeaderCellDef scope="row">Requested Quantity by Treasury Office</th>
                  <td mat-cell *matCellDef="let element" class="leftAlign">
                    <div *ngIf="element.isNew">
                      <mat-form-field floatLabel="never">
                        <input matInput [value]="element.reuseQty" [(ngModel)]="element.reuseQty"
                          [ngModelOptions]="{standalone: true}">
                      </mat-form-field>
                    </div>
                    <div *ngIf="!element.isNew">
                      {{element.reuseQty}}
                    </div>
                  </td>
                </ng-container>

                <!-- Quantity Issued By SSO / Treasury Office (Label / Stamp) -->
                <ng-container matColumnDef="qtyApp">
                  <th mat-header-cell *matHeaderCellDef scope="row">Quantity Issued By SSO / Treasury Office <br>
                    (Label / Stamp)</th>
                  <td mat-cell *matCellDef="let element" class="leftAlign">{{element.qtyApp}}
                  </td>
                </ng-container>

                <!-- Actual Quantity Received (Label / Stamp) -->
                <ng-container matColumnDef="actualQtyRec">
                  <th mat-header-cell *matHeaderCellDef scope="row">Actual Quantity Received <br> (Label / Stamp)</th>
                  <td mat-cell *matCellDef="let element" class="leftAlign">
                    <mat-form-field class="full-width">
                      <input matInput type="number" min="0">
                    </mat-form-field>
                  </td>
                </ng-container>

                <!--Quantity Returned by STO (Label / Stamp) -->
                <ng-container matColumnDef="reuseQtySub">
                  <th mat-header-cell *matHeaderCellDef scope="row">Quantity Returned by STO (Label / Stamp)</th>
                  <td mat-cell *matCellDef="let element" class="leftAlign"> 
                    <div *ngIf="element.isNew">
                      <mat-form-field floatLabel="never">
                        <input matInput [value]="element.reuseQtySub" [(ngModel)]="element.reuseQtySub"
                          [ngModelOptions]="{standalone: true}">
                      </mat-form-field>
                    </div>
                    <div *ngIf="!element.isNew">
                      {{element.reuseQtySub}}
                    </div>
                   </td>
                </ng-container>

                <!-- Actual Quantity Received by TO (Label / Stamp) -->
                <ng-container matColumnDef="actQtyRecTo">
                  <th mat-header-cell *matHeaderCellDef scope="row">Actual Quantity Received by TO (Label / Stamp)</th>
                  <td mat-cell *matCellDef="let element" class="leftAlign">
                    <mat-form-field class="full-width leftAlign">
                      <input matInput type="text" [value]="element.actQtyRecTo" [(ngModel)]="element.actQtyRecTo"
                        [ngModelOptions]="{standalone: true}">
                    </mat-form-field>
                  </td>
                </ng-container>

                <!-- From Series -->
                <ng-container matColumnDef="fromSeries">
                  <th mat-header-cell *matHeaderCellDef scope="row">From Series</th>
                  <td mat-cell *matCellDef="let element" class="leftAlign">
                    <mat-form-field class="full-width leftAlign">
                      <input matInput type="text" [value]="element.fromSeries" [(ngModel)]="element.fromSeries"
                        [ngModelOptions]="{standalone: true}" [disabled]="element.isDisable" required>
                    </mat-form-field>
                  </td>
                </ng-container>

                <!-- To Series -->
                <ng-container matColumnDef="toSeries">
                  <th mat-header-cell *matHeaderCellDef scope="row">To Series</th>
                  <td mat-cell *matCellDef="let element" class="leftAlign">
                    <mat-form-field class="full-width leftAlign">
                      <input matInput type="text" [value]="element.toSeries" [(ngModel)]="element.toSeries"
                        [ngModelOptions]="{standalone: true}" [disabled]="element.isDisable" required>
                    </mat-form-field>
                  </td>
                </ng-container>

                <!-- Action -->
                <ng-container matColumnDef="action">
                  <th mat-header-cell *matHeaderCellDef scope="row">Action</th>
                  <td mat-cell [ngClass]="element.rowStyleClass" *matCellDef="let element;let i=index" class="text-left">
                    <div class="form-action-button">
                      <a (click)="openAddDetails(element)">
                        <i class="material-icons plus plus add" title="add">add</i>
                      </a>
                    </div>
                  </td>
                </ng-container>

                <!-- Expansion section -->
                <ng-container matColumnDef="expandedDetail" expandedElement=null>
                  <tr>
                      <td mat-cell *matCellDef="let outerElement" [attr.colspan]="12">
                          <div class="element-detail"
                              [@expandRow]="outerElement === expandedElement ? 'expanded' : 'collapsed'"
                              [style.height]="0">
                              <table mat-table [dataSource]="outerElement.innerDataSource" aria-describedby="stampReceiptToTable"
                                class="classForBackground wordBreakForPanel">
                
                                <!-- Sr. No.  -->
                                <ng-container matColumnDef="position">
                                  <th mat-header-cell *matHeaderCellDef scope="row">Sr. No. </th>
                                  <td mat-cell *matCellDef="let element;let i=index" class="centerAlign"> {{element.position}} </td>
                                </ng-container>
                
                                <!-- Type Of Stamp -->
                                <ng-container matColumnDef="typeOfStamp">
                                  <th mat-header-cell *matHeaderCellDef scope="row">Type Of Stamp</th>
                                  <td mat-cell *matCellDef="let element" class="leftAlign">
                                      {{element.typeOfStamp}}
                                  </td>
                                </ng-container>
                
                                <!-- Denomination Value -->
                                <ng-container matColumnDef="deno">
                                  <th mat-header-cell *matHeaderCellDef scope="row">Denomination Value</th>
                                  <td mat-cell *matCellDef="let element" class="leftAlign">
                                      {{element.deno}}
                                  </td>
                                </ng-container>
                
                                <!-- Stock provided against previous indent -->
                                <ng-container matColumnDef="prevIndent">
                                  <th mat-header-cell *matHeaderCellDef scope="row">Stock provided against previous indent</th>
                                  <td mat-cell *matCellDef="let element" class="leftAlign">
                                      {{element.prevIndent}}
                                  </td>
                                </ng-container>
                
                                <!-- Quantity due against previous indent -->
                                <ng-container matColumnDef="qtyprevIndent">
                                  <th mat-header-cell *matHeaderCellDef scope="row">Quantity due against previous indent</th>
                                  <td mat-cell *matCellDef="let element" class="leftAlign">
                                      {{element.qtyprevIndent}}
                                  </td>
                                </ng-container>
                
                                <!-- Requested Quantity by Treasury Office -->
                                <ng-container matColumnDef="reuseQty">
                                  <th mat-header-cell *matHeaderCellDef scope="row">Requested Quantity by Treasury Office</th>
                                  <td mat-cell *matCellDef="let element" class="leftAlign">
                                      {{element.reuseQty}}
                                  </td>
                                </ng-container>
                
                                <!-- Quantity Issued By SSO / Treasury Office (Label / Stamp) -->
                                <ng-container matColumnDef="qtyApp">
                                  <th mat-header-cell *matHeaderCellDef scope="row">Quantity Issued By SSO / Treasury Office <br>
                                    (Label / Stamp)</th>
                                  <td mat-cell *matCellDef="let element" class="leftAlign">{{element.qtyApp}}
                                  </td>
                                </ng-container>
                
                                <!-- Actual Quantity Received (Label / Stamp) -->
                                <ng-container matColumnDef="actualQtyRec">
                                  <th mat-header-cell *matHeaderCellDef scope="row">Actual Quantity Received <br> (Label / Stamp)</th>
                                  <td mat-cell *matCellDef="let element" class="leftAlign">
                                  </td>
                                </ng-container>
                
                                <!--Quantity Returned by STO (Label / Stamp) -->
                                <ng-container matColumnDef="reuseQtySub">
                                  <th mat-header-cell *matHeaderCellDef scope="row">Quantity Returned by STO (Label / Stamp)</th>
                                  <td mat-cell *matCellDef="let element" class="leftAlign"> 
                                      {{element.reuseQtySub}}
                                   </td>
                                </ng-container>
                
                                <!-- Actual Quantity Received by TO (Label / Stamp) -->
                                <ng-container matColumnDef="actQtyRecTo">
                                  <th mat-header-cell *matHeaderCellDef scope="row">Actual Quantity Received by TO (Label / Stamp)</th>
                                  <td mat-cell *matCellDef="let element" class="leftAlign">
                                    {{element.actQtyRecTo}}
                                  </td>
                                </ng-container>
                
                                <!-- From Series -->
                                <ng-container matColumnDef="fromSeries">
                                  <th mat-header-cell *matHeaderCellDef scope="row">From Series</th>
                                  <td mat-cell *matCellDef="let element" class="leftAlign">
                                    {{element.fromSeries}}
                                  </td>
                                </ng-container>
                
                                <!-- To Series -->
                                <ng-container matColumnDef="toSeries">
                                  <th mat-header-cell *matHeaderCellDef scope="row">To Series</th>
                                  <td mat-cell *matCellDef="let element" class="leftAlign">
                                    {{element.toSeries}}
                                  </td>
                                </ng-container>
                
                                <!-- Action -->
                                <ng-container matColumnDef="action">
                                  <th mat-header-cell *matHeaderCellDef scope="row">Action</th>
                                  <td mat-cell [ngClass]="element.rowStyleClass" 
                                  *matCellDef="let element;let i=index" class="centerAlign">
                                      <a (click)="deleteRow(outerElement,i)"><i class="material-icons plus delete" aria-hidden="true"
                                      title="delete">delete</i></a>
                                  </td>
                                </ng-container>
                
                                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                
                              </table>
                            </div>
                      </td>
                  </tr>
                  </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row [ngClass]="row.rowStyleClass" *matRowDef="let row; columns: displayedColumns;"
                (click)="expandedElement = (expandedElement === row) ? null : row"></tr>
                <!-- Expan Section row -->
                <tr class="example-detail-row" mat-row *matRowDef="let row; columns: ['expandedDetail']"></tr>

              </table>
          
            <div class="form-action-button">
              <button mat-raised-button color="primary" title="Received">
                <i class="material-icons" aria-hidden="true">
                  call_received
                </i>
                Received
              </button>
            </div>
          </div>

      <!-- Action Buttons -->
      <div class="form-action-button">
        <button type="submit" mat-raised-button color="primary">
          <i class="material-icons" aria-hidden="true" title="Save">
            save
          </i>
          Save as Draft
        </button>
        <button mat-raised-button type="submit" (click)="directiveObject.sumbit('stampReceipt')" class="green">
          <i class="material-icons" aria-hidden="true">
            done
          </i> Submit
        </button>

        <button type="button" mat-raised-button (click)="gotoListing()" color="warn">
          <i class="material-icons" aria-hidden="true" title="Listing">
            list
          </i>
          Listing
        </button>

        <button type="button" mat-raised-button (click)="directiveObject.closeConfirmationPopup()" class="btnClose">
          <i class="material-icons" aria-hidden="true" title="Dashboard">
            close
          </i>
          Close
        </button>
      </div>
    </div>

  </div>
</div>