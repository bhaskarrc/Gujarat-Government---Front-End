<div class="container-fluid">
  <div class="form-wrapper">
    <div class="heading-section ng-star-inserted text-center">
      Finance Department
      <div class="font-heading"><strong>Reference Number:</strong> 19-20/BUD/SCE/001</div>
      <div class="font-heading"><strong>Reference Date:</strong> {{ date | date: 'dd-MMM-yyyy HH:mm'}}</div>
    </div>
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="#">Home</a></li>
        <li class="breadcrumb-item"><a href="#">Budget</a></li>
        <li class="breadcrumb-item"><a href="#">Administrative Activities</a></li>
        <li class="breadcrumb-item active" aria-current="page">Freeze Unfreeze Budget Ceiling</li>
      </ol>
    </nav>

    <div>
      <mat-tab-group mat-stretch-tabs>
        <mat-tab>
          <ng-template mat-tab-label>
            Finance Department Level
          </ng-template>
          <div #parentGrids>
            <!-- <h6>Finance Department Level</h6> -->
            <form [formGroup]="financeOfDepartMentForm" (ngSubmit)="financeOfDepartMentData()">
              <div class="box-body">
                <div class="row">
                  <div class="col-sm-3">
                    <mat-form-field>
                      <mat-select name="financeYeasr" formControlName="financeYear" placeholder="Financial Year">
                        <mat-option *ngFor="let finance of finance_list" [value]="finance.value">
                          {{finance.viewValue}}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                </div>
              </div>
              <div class="form-action-button">
                <button type="submit" mat-raised-button color="primary" (click)="show()">
                  <i class="material-icons" aria-hidden="true">search</i>
                  Search
                </button>
              </div>
            </form>
            <div class="form-datatable-list" *ngIf="isVissible">
              <div class="rsClass"> (₹ in Lakhs) </div>
              <table mat-table aria-describedby="financeDeptTable" [dataSource]="datasource" class="text-center">

                <ng-container matColumnDef="srno">
                  <th mat-header-cell *matHeaderCellDef scope="row" [ngStyle]="{'display': 'none'}">
                    <b>Sr. No.</b>
                  </th>
                  <td mat-cell *matCellDef="let item; let i = index" class="centerAlign">
                    {{ i + 1 }}
                  </td>
                  <td [ngStyle]="{'display': 'none'}" mat-footer-cell *matFooterCellDef>Total</td>
                </ng-container>

                <ng-container matColumnDef="departmentName">
                  <th mat-header-cell *matHeaderCellDef scope="row" [ngStyle]="{'display': 'none'}">
                    <b>Department Name</b>
                  </th>
                  <td style="max-width: 150px !important;" mat-cell *matCellDef="let element" class="rightAllign">
                    <a (click)="goto()">{{element.departmentName}}</a>
                  </td>
                  <td class="text-right" mat-footer-cell [attr.colspan]="2" *matFooterCellDef>
                    <b>Total</b></td>
                </ng-container>

                <ng-container matColumnDef="budgetCeilingRevenue">
                  <th mat-header-cell *matHeaderCellDef scope="row">
                    <b>Revenue</b>
                  </th>
                  <td mat-cell *matCellDef="let element" class="rightAllign">
                    <div class="row">
                      <div class="col-sm-8">
                        <mat-form-field floatLabel="never" class="rightAlign">
                          <input matInput [value]="element.revenue" [(ngModel)]="element.revenue"
                            (blur)="element.revenue < element.approvedRevenue ? element.revenue = 0 : ''">
                          <div class="text-danger" *ngIf="element.revenue < element.approvedRevenue">
                            Revenue amount cannot be less than Approved Estimate
                          </div>
                        </mat-form-field>
                      </div>
                      <div class="col-sm-2">
                        <i aria-hidden="true" class="material-icons btn-history " title="View History"
                          (click)="openHistory(element)">history</i>
                      </div>
                    </div>
                  </td>
                  <td class="text-right" mat-footer-cell *matFooterCellDef><b>{{calculation('revenue')}}</b></td>
                </ng-container>

                <ng-container matColumnDef="budgetCeilingCapital">
                  <th mat-header-cell *matHeaderCellDef scope="row">
                    <b>Capital</b>
                  </th>
                  <td mat-cell *matCellDef="let element" class="rightAllign">
                    <div class="row">
                      <div class="col-sm-8">
                        <mat-form-field floatLabel="never" class="rightAlign">
                          <input matInput [value]="element.capital" [(ngModel)]="element.capital"
                            (blur)="element.capital < element.approvedCapital ? element.capital = 0 : ''">
                          <div class="text-danger" *ngIf="element.capital < element.approvedCapital">
                            Capital amount cannot be less than Approved Capital
                          </div>
                        </mat-form-field>
                      </div>
                      <div class="col-sm-2">
                        <i class="material-icons btn-history " title="View History" (click)="openHistory()">history</i>
                      </div>
                    </div>
                  </td>
                  <td class="text-right" mat-footer-cell *matFooterCellDef><b>{{calculation('capital')}}</b></td>
                </ng-container>
                <ng-container matColumnDef="budgetPendingBudgetRevenue">
                  <th mat-header-cell *matHeaderCellDef scope="row"><b>Revenue</b></th>
                  <td mat-cell *matCellDef="let element" class="text-right rightAllign">
                    {{element.budgetPendingBudgetRevenue}}
                  </td>
                  <td class="text-right" mat-footer-cell *matFooterCellDef>
                    <b>{{calculation('approvedRevenue')}}</b>
                  </td>
                </ng-container>

                <ng-container matColumnDef="budgetPendingBudgetCapital">
                  <th mat-header-cell *matHeaderCellDef scope="row"><b>Capital</b></th>
                  <td mat-cell *matCellDef="let element" class="text-right rightAllign">
                    {{element.budgetPendingBudgetCapital}}
                  </td>
                  <td class="text-right" mat-footer-cell *matFooterCellDef>
                    <b>{{calculation('approvedCapital')}}</b>
                  </td>
                </ng-container>
                <!-- approvedBudgetEstimatesRevenue -->
                <ng-container matColumnDef="approvedBudgetEstimatesRevenue">
                  <th mat-header-cell *matHeaderCellDef scope="row"><b>Revenue</b></th>
                  <td mat-cell *matCellDef="let element" class="text-right rightAllign">
                    {{element.approvedRevenue}}
                  </td>
                  <td class="text-right" mat-footer-cell *matFooterCellDef>
                    <b>{{calculation('approvedRevenue')}}</b>
                  </td>
                </ng-container>

                <ng-container matColumnDef="approvedBudgetEstimatesCapital">
                  <th mat-header-cell *matHeaderCellDef scope="row"><b>Capital</b></th>
                  <td mat-cell *matCellDef="let element" class="text-right rightAllign">
                    {{element.approvedCapital}}
                  </td>
                  <td class="text-right" mat-footer-cell *matFooterCellDef>
                    <b>{{calculation('approvedCapital')}}</b>
                  </td>
                </ng-container>

                <ng-container matColumnDef="remainingCeilingRevenue">
                  <th mat-header-cell *matHeaderCellDef scope="row"><b>Revenue</b></th>
                  <td mat-cell *matCellDef="let element" class="rightAllign text-right">
                    {{element.revenue - element.budgetPendingBudgetRevenue - element.approvedRevenue}}
                  </td>
                  <td class="text-right" mat-footer-cell *matFooterCellDef>
                    <b>{{calcualteRemainRevenue()}}</b>
                  </td>
                </ng-container>

                <ng-container matColumnDef="remainingCeilingCapital">
                  <th mat-header-cell *matHeaderCellDef scope="row"><b>Capital</b></th>
                  <td mat-cell *matCellDef="let element" class="rightAllign text-right">
                    {{element.capital - element.budgetPendingBudgetCapital - element.approvedCapital}}
                  </td>
                  <td class="text-right" mat-footer-cell *matFooterCellDef>
                    <b>{{calcualteRemainCapital()}}</b>
                  </td>
                </ng-container>


                <ng-container matColumnDef="action">
                  <th mat-header-cell *matHeaderCellDef scope="row" [ngStyle]="{'display': 'none'}">
                    <b>Action.</b>
                  </th>

                  <td mat-cell *matCellDef="let element;let i = index;" class="action-btn-i centerAlign">
                    <a [routerLink]="'../physical-target'"><i aria-hidden="true" class="material-icons plus edit-icon"
                        title="Edit">
                        edit </i></a>
                  </td>
                  <td class="text-right" mat-footer-cell *matFooterCellDef>
                    <b></b>
                  </td>
                </ng-container>



                <ng-container matColumnDef="SrNo">
                  <th mat-header-cell *matHeaderCellDef scope="row" [attr.rowspan]="2">Sr. No</th>
                </ng-container>

                <ng-container matColumnDef="DepartmenName">
                  <th mat-header-cell *matHeaderCellDef scope="row" [attr.rowspan]="2">Department Name</th>
                </ng-container>

                <ng-container matColumnDef="BudgetCeiling1">
                  <th mat-header-cell *matHeaderCellDef scope="row" [attr.colspan]="2">Budget Ceiling</th>
                </ng-container>

                <ng-container matColumnDef="BudgetPendingBudget">
                  <th mat-header-cell *matHeaderCellDef scope="row" [attr.colspan]="2">
                    Proposed Budget (Pending with FD)
                  </th>
                </ng-container>

                <ng-container matColumnDef="BudgetCeilingApproved">
                  <th mat-header-cell *matHeaderCellDef scope="row" [attr.colspan]="2">
                    Budget Ceiling (Approved Budget Estimate)
                  </th>
                </ng-container>

                <ng-container matColumnDef="RemainingCeiling">
                  <th mat-header-cell *matHeaderCellDef scope="row" [attr.colspan]="2">
                    Remaining Ceiling
                  </th>
                </ng-container>

                <ng-container matColumnDef="Action">
                  <th mat-header-cell *matHeaderCellDef scope="row" [attr.rowspan]="2">Action</th>
                </ng-container>
                <ng-container matColumnDef="1">
                  <th mat-header-cell *matHeaderCellDef scope="row" class="tblwithoutBg">1</th>
                </ng-container>
                <ng-container matColumnDef="2">
                  <th mat-header-cell *matHeaderCellDef scope="row" class="tblwithoutBg">2</th>
                </ng-container>
                <ng-container matColumnDef="3">
                  <th mat-header-cell *matHeaderCellDef scope="row" class="tblwithoutBg">3</th>
                </ng-container>
                <ng-container matColumnDef="4">
                  <th mat-header-cell *matHeaderCellDef scope="row" class="tblwithoutBg">4</th>
                </ng-container>
                <ng-container matColumnDef="5">
                  <th mat-header-cell *matHeaderCellDef scope="row" class="tblwithoutBg">5</th>
                </ng-container>
                <ng-container matColumnDef="6">
                  <th mat-header-cell *matHeaderCellDef scope="row" class="tblwithoutBg">6</th>
                </ng-container>
                <ng-container matColumnDef="7">
                  <th mat-header-cell *matHeaderCellDef scope="row" class="tblwithoutBg">7</th>
                </ng-container>
                <ng-container matColumnDef="8">
                  <th mat-header-cell *matHeaderCellDef scope="row" class="tblwithoutBg">8</th>
                </ng-container>
                <ng-container matColumnDef="9">
                  <th mat-header-cell *matHeaderCellDef scope="row" class="tblwithoutBg">9</th>
                </ng-container>
                <ng-container matColumnDef="10">
                  <th mat-header-cell *matHeaderCellDef scope="row" class="tblwithoutBg">10</th>
                </ng-container>
                <ng-container matColumnDef="11">
                  <th mat-header-cell *matHeaderCellDef scope="row" class="tblwithoutBg">11</th>
                </ng-container>

                <tr mat-header-row
                  *matHeaderRowDef="['SrNo','DepartmenName','BudgetCeiling1','BudgetPendingBudget','BudgetCeilingApproved','RemainingCeiling' ,'Action']">
                </tr>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-header-row class="unsetHeight"
                  *matHeaderRowDef="['1','2','3','4','5','6','7','8','9','10','11']"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                <tr mat-footer-row *matFooterRowDef="displayedColumns"></tr>
              </table>
              <div class="form-action-button">
                <button type="submit" mat-raised-button color="primary" class="btn-print">
                  <i class="material-icons" aria-hidden="true">print </i>
                  Print
                </button>
                <button type="submit" mat-raised-button color="primary">
                  <i aria-hidden="true" class="material-icons" title="Save">
                    save
                  </i>
                  Save
                </button>
                <button mat-raised-button type="submit" class="green" (click)="submitDetails()">
                  <i aria-hidden="true" class="material-icons">
                    done </i> Submit
                </button>
                <button type="button" mat-raised-button (click)="goToDashboard()" class="btnClose">
                  <i class="material-icons" aria-hidden="true" title="Budget dashboard">
                    close
                  </i>
                  Close
                </button>

              </div>

            </div>
          </div>
        </mat-tab>
        <mat-tab label="Attachments">
          <table mat-table aria-describedby="attachmentTable" [dataSource]="dataSourceBrowse" width="100%" id="browseTable">
            <ng-container matColumnDef="position">
              <th mat-header-cell *matHeaderCellDef scope="row">Sr. No.</th>
              <td mat-cell *matCellDef="let item; let i = index" class="centerAlign">
                {{ i + 1 }}
              </td>
            </ng-container>
            <ng-container matColumnDef="attachmentType">
              <th mat-header-cell *matHeaderCellDef scope="row">Attachment Type</th>
              <td mat-cell *matCellDef="let item;let i = index;">
                <mat-form-field>
                  <mat-select placeholder="Attachment Type" #singleSelect1 required>
                    <mat-option>
                      <ngx-mat-select-search [formControl]="attachmentTypeCodeCtrl"
                        [placeholderLabel]="'Find Attachment Type...'"
                        [noEntriesFoundLabel]="'no matching Attachment Type found'">
                      </ngx-mat-select-search>
                    </mat-option>

                    <mat-option *ngFor="let AT of filteredAttachmentTypeCode" [value]="AT.value">
                      {{AT.viewValue}}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </td>
            </ng-container>
            <ng-container matColumnDef="fileName">
              <th mat-header-cell *matHeaderCellDef scope="row">File name</th>
              <td mat-cell *matCellDef="let item">
                <mat-form-field floatLabel="never">
                  <textarea matInput [value]="item.name" [(ngModel)]="item.name"></textarea>
                </mat-form-field>
              </td>
            </ng-container>
            <ng-container matColumnDef="browse">
              <th mat-header-cell *matHeaderCellDef scope="row">Browse File</th>

              <td mat-cell *matCellDef="let i = index" class="centerAlign">
                <button type="button" (click)="openFileSelector(i)" class="btn-browse">Browse
                  Files</button>
              </td>
            </ng-container>
            <ng-container matColumnDef="uploadedFileName">
              <th mat-header-cell *matHeaderCellDef scope="row">Uploaded file Name</th>
              <td mat-cell *matCellDef="let item">
                <span *ngIf="item.file && item.file.name">{{item.file.name}}</span>
              </td>
            </ng-container>

            <ng-container matColumnDef="uploadedBy">
              <th mat-header-cell *matHeaderCellDef scope="row">Uploaded By</th>
              <td mat-cell *matCellDef="let item">
                <!-- <mat-label>Mr. Pratik Shah</mat-label> -->
                <mat-form-field>
                  <input matInput [(ngModel)]="item.uploadedBy">
                </mat-form-field>
              </td>
            </ng-container>

            <ng-container matColumnDef="action">
              <th mat-header-cell *matHeaderCellDef scope="row">Action</th>
              <td mat-cell *matCellDef="let item; let i = index">
                <table class="iconTable">
                  <tbody>
                    <tr>
                      <td width="30">
                        <i aria-hidden="true" class="material-icons plus delete"
                          *ngIf="dataSourceBrowse && dataSourceBrowse.data && dataSourceBrowse.data.length > 1"
                          (click)="deleteBrowse(i)">
                          delete
                        </i>
                      </td>
                      <td width="30">
                        <i aria-hidden="true" class="material-icons plus add"
                          *ngIf="dataSourceBrowse && dataSourceBrowse.data && (i == dataSourceBrowse.data.length - 1)"
                          (click)="addBrowse()">
                          add
                        </i>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="displayedBrowseColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedBrowseColumns;"></tr>
          </table>
          <!-- <ngx-file-drop dropZoneLabel="Drop files here" (onFileDrop)="dropped($event)" 
          (onFileOver)="fileOver($event)" (onFileLeave)="fileLeave($event)">
          <ng-template ngx-file-drop-content-tmp let-openFileSelector="openFileSelector">
          <button type="button" (click)="openFileSelector()">Browse Files</button>
          </ng-template>
          </ngx-file-drop> -->
          <input type="file" id="fileBrowse" style="visibility: hidden;" />

          <div class="legend">
            1. Total File size should be under 2MB<br> 2. File type supported are: 'jpg', 'jpeg', 'png', 'pdf', JPG’,
            ‘JPEG’, ‘PNG’, ‘PDF’.
          </div>

          <div class="form-action-button">
            <button type="submit" mat-raised-button color="primary">
              <i class="material-icons" aria-hidden="true" title="Save">
                save
              </i>
              Upload
            </button>
            <!-- <button mat-raised-button type="submit" class="green"><i class="material-icons" aria-hidden="true">
                      done
                  </i> Submit</button> -->
            <!-- <button type="reset" mat-raised-button color="accent">
                  <i class="material-icons" aria-hidden="true">
                      restore
                  </i>
                  Reset
              </button> -->
            <!-- <button type="button" mat-raised-button color="warn">
              <i class="material-icons" aria-hidden="true" title="Listing">
                list
              </i>
              Listing
            </button> -->
            <button type="button" mat-raised-button class="btnClose">
              <i class="material-icons" aria-hidden="true" title="Budget dashboard">
                close
              </i>
              Close
            </button>

          </div>
        </mat-tab>
      </mat-tab-group>
    </div>
  </div>
</div>
